# Quantum Flow Matching with Adaptive Observables

This document outlines a novel Quantum Machine Learning (QML) framework: **Quantum Flow Matching**. This algorithm leverages Lie algebra-based exponential mapping to create continuous, high-dimensional data encodings (flows) and utilizes adaptive, learnable observables to ensure trainability and feasibility on near-term quantum hardware.

## 1. Creating Quantum Flow Matching via Exponential Mapping

Standard Variational Quantum Circuits (VQCs) often treat quantum gates as discrete, fixed operations. However, "Flow Matching" implies a continuous transformation of a probability density or state. We can achieve this rigorous "quantum flow" using the multivariate  parameterization proposed by Wiersema et al. (2024).

### 1.1 The Concept: Unitary Evolution as a Geodesic Flow

In this framework, the "flow" is defined not by a sequence of discrete gates, but by a continuous time evolution generated by a Hamiltonian. This Hamiltonian is constructed directly from input data or trainable parameters using the Lie algebra $\mathfrak{su}(N)$.

Wiersema et al. (2024) define the $\mathbb{SU}(N)$ gate using the exponential map:
$$U(\theta) = \exp\{A(\theta)\}, \quad \text{where } A(\theta) = \sum_{m} \theta_m G_m$$
* $\theta = (\theta_1, \dots, \theta_{N^2-1})$ are the classical parameters (canonical coordinates).
* $G_m$ are the basis elements of the Lie algebra $\mathfrak{su}(N)$ (e.g., Pauli strings).
* $A(\theta)$ is a skew-Hermitian operator representing the generator of the flow.

### 1.2 Formulating the Quantum Flow

To create a Quantum Flow Matching algorithm, we replace the trainable parameters $\theta$ with input data $\mathbf{x}$. The unitary $U(\mathbf{x})$ becomes a data-dependent diffeomorphism that maps the initial state $|0\rangle$ to an encoded state $|\psi(\mathbf{x})\rangle$ along a continuous path.

The flow is governed by the Schrödinger-like Ordinary Differential Equation (ODE):
$$\frac{d}{dt} U(\mathbf{x}; t) = A(\mathbf{x}) U(\mathbf{x}; t)$$
where the effective Hamiltonian is $A(\mathbf{x}) = \sum_i x_i G_i$.

**Key Mathematical Properties:**

1. 
**Geodesic Paths:** Wiersema et al. prove that for a normalized Hamiltonian, the evolution $U(\mathbf{x}; t)$ traces a **geodesic** (shortest path) on the unitary manifold $SU(N)$ from the identity $I$ to the target operator. This is mathematically equivalent to the "straight paths" often desired in classical Flow Matching (e.g., Rectified Flow) to simplify optimization.

2. 
**Unbiased Landscape:** Unlike standard decomposed gates (e.g., $R_z R_y R_z$), which distort the parameter space, this exponential mapping provides an **unbiased** parameterization of the Lie algebra. This ensures the "flow" does not suffer from artificial vanishing gradients caused by the choice of gate decomposition.


---

## 2. Ensuring Feasibility with Adaptive & Learnable Observables

While the exponential map provides a theoretically perfect flow, implementing it on hardware is costly. A dense encoding $U(\mathbf{x}) = \exp(\sum x_i G_i)$ usually requires a decomposition into a deep circuit of standard gates, which accumulates noise and is infeasible for near-term devices.

To solve this, we shift the complexity from the **circuit (unitary evolution)** to the **measurement (observable)** using the methods proposed by Chen et al. (2025) and Lin et al. (2025).

### 2.1 Expanding the Spectrum with Learnable Observables (Chen et al., 2025)

Standard quantum flows typically measure fixed Pauli observables (e.g., $Z$), which restricts the output to the range $[-1, 1]$ (the eigenvalues of Pauli matrices). This is a major limitation for Generative AI tasks where the target distribution may be unbounded or complex.

**The Solution:**
Instead of a fixed $Z$, we make the observable $B$ a learnable Hermitian matrix. This allows the model to dynamically scale its output range.

**Mathematical Formulation:**
The expectation value (model output) becomes:
$$f(\mathbf{x}) = \langle 0 | U^\dagger(\mathbf{x}) B(\mathbf{b}) U(\mathbf{x}) | 0 \rangle$$

The learnable Hermitian matrix $B(\mathbf{b})$ is parameterized by complex coefficients $b_{ij}$:
$$B(\mathbf{b}) = \sum_{i,j} b_{ij} E_{ij}, \quad \text{where } b_{ij} = \overline{b_{ji}}$$

Here, $E_{ij}$ is the indicator matrix. By training the parameters $\mathbf{b}$ via gradient descent, the model can expand the spectral range $[\lambda_{min}, \lambda_{max}]$ of the measurement.

**Benefit:** This allows the Quantum Flow model to fit complex target distributions without needing deeper circuits to artificially stretch or shift the quantum state values.

### 2.2 Reducing Depth with Adaptive Non-Local Observables (Lin et al., 2025)

Implementing the "flow" circuit $U(\mathbf{x})$ is expensive. Lin et al. (2025) propose the **Adaptive Non-Local Observable (ANO)** framework, inspired by the Heisenberg picture, to reduce this cost.

**The Solution:**
In the Heisenberg picture, evolving a state $|\psi\rangle$ by a unitary $U(\theta)$ and measuring $H$ is equivalent to keeping the state fixed and measuring an evolved observable $H(\theta)$:
$$\langle \psi | U^\dagger(\theta) H U(\theta) | \psi \rangle \equiv \langle \psi | H(\theta) | \psi \rangle$$
This implies that instead of applying a deep variational circuit $U(\theta)$ to "twist" the flow, we can apply a simpler flow and simply **rotate the measurement basis** to capture the data correlations.

**Mathematical Formulation (k-local ANO):**
Lin et al. parameterize a k-local observable $H(\phi)$ acting on a subsystem of $k$ qubits:
$$H(\phi) = \begin{pmatrix}
c_{11} & a_{12} + i b_{12} & \dots \\
a_{12} - i b_{12} & c_{22} & \dots \\
\vdots & \vdots & \ddots
\end{pmatrix}$$
This matrix contains $K^2$ real parameters (where $K=2^k$).

**Feasibility Strategy:**
To avoid the cost of full density, Lin et al. propose two efficient measurement schemes:

1. **Sliding k-Local Measurements:** Measuring overlapping groups of $k$ qubits (e.g., qubits $(1,2), (2,3), \dots$).


2. **Pairwise Combinatorial Measurements:** Measuring all $\binom{n}{2}$ pairs of qubits.


**Benefit:** Lin et al. demonstrate that as the locality $k$ of the observable increases, the need for variational rotation gates diminishes. This means the **Quantum Flow Matching algorithm can be implemented with significantly shallower circuits**, relying on the classical post-processing of non-local measurement results to capture the complex correlations of the flow.


## References
* Wiersema, R., Lewis, D., Wierichs, D., Carrasquilla, J., & Killoran, N. (2024). Here comes the SU(N): multivariate quantum gates and gradients. _Quantum_, 8, 1275. https://doi.org/10.22331/q-2024-03-07-1275
* Lin, H.-Y., Tseng, H.-H., Chen, S. Y.-C., & Yoo, S. (2025, 30 Aug.–5 Sept. 2025). Adaptive Non-Local Observable on Quantum Neural Networks. _2025 IEEE International Conference on Quantum Computing and Engineering (QCE)_.
* Chen, S. Y.-C., Tseng, H.-H., Lin, H.-Y., & Yoo, S. (2025). Learning to Measure Quantum Neural Networks. _ICASSP 2025 Workshop: Quantum Machine Learning in Signal Processing and Artificial Intelligence_.
